swagger: "2.0"
info:
  title: InnerPeace API
  version: "1.0.0"

schemes: ["https"]
produces: ["application/json"]

paths:
  /healthz:
    get:
      operationId: healthz
      x-google-allowWithoutApiKey: true
      security: []
      x-google-backend:
        address: "https://innerpeace-api-379484922687.europe-west2.run.app"
        path_translation: APPEND_PATH_TO_ADDRESS
        jwt_audience: "https://innerpeace-api-379484922687.europe-west2.run.app"
      responses:
        "200": { description: "OK" }
    options:
      operationId: healthzOptions
      x-google-allowWithoutApiKey: true
      security: []
      x-google-backend:
        address: "https://innerpeace-api-379484922687.europe-west2.run.app"
        path_translation: APPEND_PATH_TO_ADDRESS
        jwt_audience: "https://innerpeace-api-379484922687.europe-west2.run.app"
      responses:
        "204": { description: "CORS preflight" }

  /api/media/list:
    get:
      operationId: listMedia
      x-google-allowWithoutApiKey: true
      x-google-backend:
        address: "https://innerpeace-api-379484922687.europe-west2.run.app"
        path_translation: APPEND_PATH_TO_ADDRESS
        jwt_audience: "https://innerpeace-api-379484922687.europe-west2.run.app"
      parameters:
        - name: folderId
          in: query
          required: true
          type: string
        - name: pageToken
          in: query
          required: false
          type: string
        - name: pageSize
          in: query
          required: false
          type: integer
      responses:
        "200": { description: "OK" }
        "400": { description: "Missing folderId" }
        "401": { description: "Unauthorized" }

  /api/{path=**}:
    get:
      operationId: passthroughGet
      x-google-allowWithoutApiKey: true
      parameters:
        - name: path
          in: path
          type: string
          required: true
      x-google-backend:
        address: "https://innerpeace-api-379484922687.europe-west2.run.app"
        path_translation: APPEND_PATH_TO_ADDRESS
        jwt_audience: "https://innerpeace-api-379484922687.europe-west2.run.app"
      responses:
        "200": { description: "OK" }
        "401": { description: "Unauthorized" }
    post:
      operationId: passthroughPost
      x-google-allowWithoutApiKey: true
      parameters:
        - name: path
          in: path
          type: string
          required: true
      x-google-backend:
        address: "https://innerpeace-api-379484922687.europe-west2.run.app"
        path_translation: APPEND_PATH_TO_ADDRESS
        jwt_audience: "https://innerpeace-api-379484922687.europe-west2.run.app"
      responses:
        "200": { description: "OK" }
        "401": { description: "Unauthorized" }
    put:
      operationId: passthroughPut
      x-google-allowWithoutApiKey: true
      parameters:
        - name: path
          in: path
          type: string
          required: true
      x-google-backend:
        address: "https://innerpeace-api-379484922687.europe-west2.run.app"
        path_translation: APPEND_PATH_TO_ADDRESS
        jwt_audience: "https://innerpeace-api-379484922687.europe-west2.run.app"
      responses:
        "200": { description: "OK" }
        "401": { description: "Unauthorized" }
    delete:
      operationId: passthroughDelete
      x-google-allowWithoutApiKey: true
      parameters:
        - name: path
          in: path
          type: string
          required: true
      x-google-backend:
        address: "https://innerpeace-api-379484922687.europe-west2.run.app"
        path_translation: APPEND_PATH_TO_ADDRESS
        jwt_audience: "https://innerpeace-api-379484922687.europe-west2.run.app"
      responses:
        "200": { description: "OK" }
        "401": { description: "Unauthorized" }
    options:
      operationId: passthroughOptions
      x-google-allowWithoutApiKey: true
      parameters:
        - name: path
          in: path
          type: string
          required: true
      security: []
      x-google-backend:
        address: "https://innerpeace-api-379484922687.europe-west2.run.app"
        path_translation: APPEND_PATH_TO_ADDRESS
        jwt_audience: "https://innerpeace-api-379484922687.europe-west2.run.app"
      responses:
        "204": { description: "CORS preflight" }

# Note: Gateway does NOT validate Supabase JWTs. Cloud Run auth is satisfied by a Google ID token
# that the gateway injects (via jwt_audience). Your app still validates Supabase tokens on /api/*.
