swagger: "2.0"
info:
  title: innerpeace-api
  version: "1.0.0"
schemes: ["https"]

# Accept Google Sign-In ID tokens from your app
securityDefinitions:
  google_jwt:
    type: oauth2
    flow: implicit
    authorizationUrl: ""   # not used
    x-google-issuer: "https://accounts.google.com"
    x-google-jwks_uri: "https://www.googleapis.com/oauth2/v3/certs"
    # Make sure the client ID your app uses is here
    x-google-audiences: "379484922687-q7ge8kg89o0vi1gn1lkjaqciu8e8e3eb.apps.googleusercontent.com"

# Default backend settings (can be overridden per-path)
x-google-backend:
  address: "https://innerpeace-api-379484922687.europe-west2.run.app"
  path_translation: APPEND_PATH_TO_ADDRESS
  jwt_audience: "https://innerpeace-api-379484922687.europe-west2.run.app"

paths:
  /health:
    get:
      operationId: getHealth
      security: []   # public for diagnostics
      responses:
        "200":
          description: OK

  /api/availability:
    get:
      operationId: getAvailability
      security: [ { google_jwt: [] } ]
      parameters:
        - name: start
          in: query
          type: string
          required: false
        - name: end
          in: query
          type: string
          required: false
      responses:
        "200": { description: OK }

  /api/book:
    post:
      operationId: postBook
      security: [ { google_jwt: [] } ]
      parameters: []   # body validated by backend
      responses:
        "200": { description: OK }

  /api/book/{id}:
    delete:
      operationId: deleteBooking
      security: [ { google_jwt: [] } ]
      parameters:
        - name: id
          in: path
          required: true
          type: string
      responses:
        "200": { description: OK }

  /api/bookings:
    get:
      operationId: getBookings
      security: [ { google_jwt: [] } ]
      parameters:
        - name: uid
          in: query
          type: string
          required: false
      responses:
        "200": { description: OK }

  /api/youtube:
    get:
      operationId: getYoutube
      security: [ { google_jwt: [] } ]
      parameters:
        - name: channelId
          in: query
          type: string
          required: true
      responses:
        "200": { description: OK }

  /api/media/list:
    get:
      operationId: listMedia
      security: [ { google_jwt: [] } ]
      parameters:
        - name: folderId
          in: query
          type: string
          required: false
      responses:
        "200": { description: OK }

  /api/media/stream/{id}:
    get:
      operationId: streamMedia
      security: [ { google_jwt: [] } ]
      parameters:
        - name: id
          in: path
          required: true
          type: string   # <-- Swagger 2.0 requires "type", not "schema"
      responses:
        "200": { description: OK }
        "206": { description: Partial content }
